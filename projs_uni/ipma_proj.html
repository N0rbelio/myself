<!DOCTYPE html>
<html lang="pt-PT">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>AndrÃ© Oliveira Page</title>

        <!-- import styles -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>


        <!-- styles -->
        <link rel="stylesheet" href="../styles/main_style.css">
        <link rel="stylesheet" href="../styles/images.css">
        <link rel="stylesheet" href="../styles/root.css">
        <link rel="stylesheet" href="../styles/nav.css">


        <!-- Highlight.js JavaScript -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/atom-one-dark.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
        
        
    </head>

    <body> 
            <body>
        <nav aria-label="Main navigation">
            <button class="hamburger" aria-label="Toggle menu" aria-controls="menu" aria-expanded="false">
                <span class="line-1"></span>
                <span class="line-2"></span>
                <span class="line-3"></span>
            </button>

            <ul class="nav-links" id="menu">
                <li><a href="../index.html">Home</a></li>
                <li class="has-submenu">
                    <a href="#" aria-expanded="false">Projetos Universidade</a>
                    <ul class="submenu">
                        <li><a href="projs_uni/pirsi.html">PIRSI</a></li>
                        <li><a href="projs_uni/ipma_proj.html">IPMA API</a></li>
                        <li><a href="projs_uni/shell-script.html">Shell Script</a></li>
                    </ul>
                </li>

                <li class="has-submenu">
                    <a href="#" aria-expanded="false">Projetos Pessoais</a>
                    <ul class="submenu">
                        <li><a href="projs_pessoal/script.html">Scripts</a></li>
                        <li><a href="projs_pessoal/homelab.html">HomeLab</a></li>
                        <li><a href="projs_pessoal/diy-router.html">DIY Router</a></li>
                    </ul>
                </li>

                <li class="has-submenu">
                    <a href="#" aria-expanded="false">Projetos Trabalho</a>
                    <ul class="submenu">
                        <li><a href="projs_trabalho/script-activex.html">Script ActiveX</a></li>
                        <li><a href="projs_trabalho/assinatura-email.html">Assinaturas de Email</a></li>
                    </ul>
                </li>
            </ul>

            <div class="language">
                <select id="lang-select">
                    <option value="en">ðŸ‡ºðŸ‡¸ English</option>
                    <option value="pt" selected>ðŸ‡µðŸ‡¹ PortuguÃªs</option>
                </select>
            </div>
        </nav>
        <div class="container">        

            <div class="text">

                <pre><code class="language-python">
##########################################################
##########################################################
###                                                 ######
###         API para IPMA - CLA Technologies        ######
###             Licenciado em LGPL v2.1             ######
###                                                 ######
###                                                 ######
##########################################################
##########################################################

#importar os modulos necessarios
from basedados import *
from urllib import request # importar conteudo url para memoria
import urllib, socket, json # # handling erros urllib, verificar conexÃ£o a internet e handling jsons respetivamente

class IPMA(): #classe IPMA
    def __init__(self, id_cidade): #criar instancias para criar este modulo, assim o contactest.py pode passar para aqui
        self.id_cidade = id_cidade # instancia publica entre funÃ§Ãµes

    def _consulta_generica(self, diaprevisao): # funcao para descarregar o json da ipma e uma instancia que vai receber o valor da funcao consulta_hoje amanha e depois de amanha
        if diaprevisao == "ValueIssue":
            return ValueError
        else:
            try: # tenta descarregar o json do ipma, se nÃ£o conseguir passa para except
                sitejson = request.urlopen('http://api.ipma.pt/open-data/forecast/meteorology/cities/daily/{}.json'.format(self.id_cidade)) #descarrega o json da ipma
            except urllib.error.HTTPError or urllib.error.URLError: # caso receber erro ou raise, acaba o modulo
                return ConnectionError
            else:
                jsonficheiro = json.loads(sitejson.read().decode(sitejson.info().get_param('charset') or 'utf-8')) #carrega o json para memoria
                fornecedorapi = jsonficheiro["owner"] # retira do json a chave owner e poe na variavel
                pais = jsonficheiro["country"] # ...
                tmpmin = float(jsonficheiro["data"][diaprevisao]["tMin"]) # ...
                tmpmax = float(jsonficheiro["data"][diaprevisao]["tMax"]) # ...
                probprecip = float(jsonficheiro["data"][diaprevisao]["precipitaProb"]) # ...
                return tmpmin, tmpmax, probprecip, pais, fornecedorapi # retorna os valores das variaveis num tuple

    def consulta_dia(self, escolha):
        try: # tenta executar o codigo de baixo
            if escolha == 0: # deteta o input da variavel escolha 0 e corre a funcao do modulo apiipma
                return self._consulta_generica(0) # retorna o dia hoje para a funÃ§Ã£o _consulta_generica
            elif escolha == 1: # ...
                return self._consulta_generica(1) # ...
            elif escolha == 2: # ...
                return self._consulta_generica(2) # ...
            else: # se nao detetar entre o alcance passa para o raise
                raise ValueError() # aqui ele sai do try com um raise que serve para mostrar o erro em vez de retornar o valor da funcao do modulo apiipma
        except ValueError as erro: # o except acaba a funcao retorna o erro
            return self._consulta_generica("ValueIssue")

def estaligado(): # funcao para detetar conectividade a internet
    try:
        sock = socket.create_connection(("www.mozilla.org", 80)) # Guarda detalhes da conexao a porta 80 mozilla
        if sock is not None: # se a conexao retornar detalhes fecha a conexao
            sock.close
        return True # e retorna True
    except OSError: # passa para o except se detetar um erro de connexao
        pass
    return False # retorna falso

# Boilerplate para nÃ£o inciar codigo atÃ© que for convocado
if __name__ == "__main__":
    print("Isto Ã© um modulo!") # indica que foi iniciado diretamente
else:
    print("Importado modulo IPMA") # text que o modulo iniciou
    conexaoTest = estaligado() # Verifica a ligaÃ§Ã£o Ã  internet antes de iniciar o modulo

# id: 1010500 cidade: Aveiro

                </code></pre>
                    
            </div>
            <br class="space0">
            <div class="text">

            </div>
            
        </div>
        

        <script src="../age_calc.js"></script>
        <script src="../nav_menus.js"></script>
    </body>
</html>
